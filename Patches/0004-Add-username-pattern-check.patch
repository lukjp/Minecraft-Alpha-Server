From 42eaab666f1c8310c277b59fa9d4b1bb32d7533e Mon Sep 17 00:00:00 2001
From: stonar96 <minecraft.stonar96@gmail.com>
Date: Tue, 3 Oct 2017 17:39:19 +0200
Subject: [PATCH] Add username pattern check


diff --git a/sources/minecraft_server/net/minecraft/src/NetLoginHandler.java b/sources/minecraft_server/net/minecraft/src/NetLoginHandler.java
index 40a9980..c911461 100644
--- a/sources/minecraft_server/net/minecraft/src/NetLoginHandler.java
+++ b/sources/minecraft_server/net/minecraft/src/NetLoginHandler.java
@@ -80,6 +80,20 @@ public class NetLoginHandler extends NetHandler
             }
             return;
         }
+        if(!username.matches("[A-Za-z0-9_]{2,16}"))//Mod: Add username pattern check
+        {//Mod: Add username pattern check
+            kickUser("Invalid username, try: [A-Za-z0-9_]{2,16}");//Mod: Add username pattern check
+            return;//Mod: Add username pattern check
+        }//Mod: Add username pattern check
+        for(int i = 0; i < mcServer.configManager.playerEntities.size(); i++)//Mod: Add username pattern check
+        {//Mod: Add username pattern check
+            EntityPlayerMP entityplayermp = (EntityPlayerMP)mcServer.configManager.playerEntities.get(i);//Mod: Add username pattern check
+            if(entityplayermp.username.equalsIgnoreCase(username))//Mod: Add username pattern check
+            {//Mod: Add username pattern check
+                kickUser("You are already online");//Mod: Add username pattern check
+                return;//Mod: Add username pattern check
+            }//Mod: Add username pattern check
+        }//Mod: Add username pattern check
         if(!mcServer.onlineMode)
         {
             doLogin(packet1login);
